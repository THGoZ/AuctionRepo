@using Auction.Core.Entities
@using APIService
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime
@inject APIService apiClient
@attribute [Authorize]

@if (Productos is not null)
{
    @foreach (var producto in Productos){
        <div class="container border border-top-0 border-start-0 border-end-0 border-bottom-5 py-2">
        <div class="row">
            <div class="col-sm">
                    @if (producto.Imagen is not null)
                {
                        <img src="@GetPreviewImage(producto)" class="rounded-4 float-start border-0 border-warning-subtle object-fit-scale img-thumbnail" alt="Producto Image" />
                }
                else
                {
                    <img src="https://www.svgrepo.com/show/508699/landscape-placeholder.svg" alt="Producto Image" />
                }
            </div>
            <div class="col-8">
                <div class="row-4">
                    <h2>@producto.Nombre</h2>
                </div>
                <div class="row-1">
                    <h6>@producto.Descripcion</h6>
                </div>
                <div class="row">
                    <h4 class="text-success-emphasis">$@producto.PrecioBase</h4>
                </div>
            </div>
            <div class="col-md">
                    <div class="row text-center py-1">
                        <h5 class="fw-semibold">@producto.NombreGanador</h5>
                    </div>
                    <div class="row text-center py-1">
                        <h5 class="fw-semibold">@producto.ApellidoGanador</h5>
                    </div>
                    <div class="row text-center mt-2">
                        <h3 class="text-success fs-5"><span class="px-3 py-2 badge-pill bg-success-subtle border border-3 border-success">$@producto.Monto</span></h3>
                    </div>
            </div>
        </div>
    </div>
    }
}
else
{
    <p>No Product</p>
}
@code {
    [Parameter]
    public int IdSubasta { get; set; }

    public List<ProductoWinner>? Productos;
    public byte[] imageData { get; set; } = null;
    public string FileType { get; set; } = "";
    public string ErrorMessage { get; set; } = "";


    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await GetProducto();
    }

    private string? GetPreviewImage(ProductoWinner producto)//para cargar en edicion al subir imagen nueva
    {
        if (imageData != null && FileType != null)
            return $"data:image/{FileType.Trim('.')};base64,{Convert.ToBase64String(imageData)}";
        else if (producto.Imagen != null && !string.IsNullOrEmpty(producto.ImageExtension))
            return $"data:image/{producto.ImageExtension.Trim('.')};base64,{Convert.ToBase64String(producto.Imagen)}";
        else
            return null;
    }

    private async Task GetProducto()
    {
        Productos = await apiClient.GetProductWinners(IdSubasta);
    }

}
